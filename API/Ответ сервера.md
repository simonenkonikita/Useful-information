## Ответ от сервера

Метод fetch возвращает объект ответа:

```javascript
fetch("https://praktikum.yandex.ru").then((res) => {
  console.log(res); // В консоли окажется объект ответа от сервера
});
```

Чтобы получить из него данные, нужно вызвать встроенный метод json

### Метод res.json

Метод json читает ответ от сервера в формате json и возвращает промис. Из этого промиса потом можно доставать нужные нам данные.

```javascript
fetch("https://api.kanye.rest")
  .then((res) => res.json())___
  .then((data) => {
    console.log(data);
  });
```

Поскольку метод json асинхронный, то и использовать его нужно таким образом:

```javascript
fetch("https://praktikum.yandex.ru")
  .then((res) => {
    return res.json(); // возвращаем результат работы метода и идём в следующий then
  })
  .then((data) => {
    console.log(data.user.name); // если мы попали в этот then, data — это объект
  })
  .catch((err) => {
    console.log("Ошибка. Запрос не выполнен");
  });
```

❌ Важно. Метод json — асинхронный метод. Такой код некорректен:

```javascript
fetch("https://praktikum.yandex.ru")
  .then((res) => {
    const data = res.json();
    console.log(data.user.name); // data — это промис, она ещё не готова
  })
  .catch((err) => {
    console.log("Ошибка. Запрос не выполнен");
  });
```

## Статус ответа

Вместо нужной страницы на экране большое число 404. Эти три цифры — код статуса ответа.

❗ У ответа всегда есть статус — он может быть отклонён, перенаправлен или вернуться с ошибкой.

По коду статуса можно понять, что произошло с запросом. \
Если код начинается с:

```

2 — значит, запрос прошёл успешно;
3 — запрос был перенаправлен;
4 — с запросом что-то не так: ресурс не найден или у вас нет к нему доступа;
5 — на сервере произошла какая-то ошибка.

```

Cамые распространённые статусы:

```

200 OK;
401 Unauthorized;
403 Forbidden;
404 Not Found;
500 Internal Server Error.

```

### Узнать статус / Метод status и statusText

После числа идёт сообщение статуса — оно объясняет, что произошло. \
Код и сообщения статуса хранятся в свойствах объекта ответа **status** и **statusText**:

```javascript
fetch("https://api.kanye.rest").then((res) => {
  console.log(res.status, res.statusText); // 200 OK
});
```

### Узнать статус / Булево свойство ok

Для удобства также доступно булево свойство ok. \
Оно хранит в себе \
**true**, если ответ успешный (начинается с 2), \
**false** — в любом другом случае:

```javascript
fetch("https://api.kanye.rest").then((res) => {
  console.log(res.ok); // true
});
```

❗По этому свойству можно определить, прошёл ли запрос успешно, и принять решение, что делать дальше:

```javascript
const quoteElement = document.querySelector("div.quote");

fetch("https://api.kanye.rest")
  .then((res) => {
    if (res.ok) {
      return res.json();
    }
    // отклоняем промис, чтобы перейти в блок catch, если сервер вернул ошибку
    return Promise.reject(`Что-то пошло не так: ${res.status}`);
  })
  .then((data) => {
    quoteElement.textContent = data.quote;
  })
  .catch((err) => {
    console.log(err); // "Что-то пошло не так: ..."
  });
```

## Другие методы и свойства ответ

## Заголовки ответа

Подобно запросам, ответы могут иметь заголовки. \
В них содержится дополнительная информация от сервера.

### Метод git / Получить данные из заголовков

Позволяет получить значение заголовка.

```javascript
fetch("https://api.kanye.rest").then((res) => {
  if (res.headers.get("Content-Type").contains("application/json")) {
    return res.json();
  }
});
```

❗ Единственное отличие заголовков ответа от заголовков запроса: первые можно только читать, но нельзя редактировать.

## Тело ответа

У ответа почти всегда есть тело. Если мы запрашиваем веб-страницу, тело ответа — HTML-код этой страницы. Телом ответа бывает просто текст, картинка или JSON-строка. Чтобы разобрать тело ответа, есть специальные методы:

```
- res.json — разбирает JSON в объект;
- res.text — разбирает тело как текст;
- res.blob — разбирает тело ответа как бинарные данные: это нужно при получении файлов (изображений, видео,  pdf-документов).
```

❗Все методы для чтения тела ответа работают асинхронно

❗Методы разбора тела возвращают промис их нужно использовать асинхронно

```javascript
fetch("https://api.kanye.rest")
  .then((res) => res.json())
  .then((result) => {
    console.log(result);
  });

fetch("https://api.kanye.rest")
  .then((res) => res.text())
  .then((result) => {
    console.log(result);
  });
```
